Offline Page Renderer<br>
This simple page has bootup code embedded locally. It sources in cross domain source code as Javascript classes and stores those codes in sql db. Later, it can retrieve and run those source code, which effectively renders the page as an interactive app. Proof of concept is successful so far.
<hr>
<script src=https://dl.dropboxusercontent.com/u/28448395/projects/android/Tweetoff-code/assets/tweetoff/dbapp.js></script>
<script src=sim_remote_class.js></script>
<script>
//8-24-15 JChoy v0.1.117 PageOff_HtmlApp, HtmlAppFactory
//8-22-15 JChoy pageoff - offline page launcher. This simple page has bootup code stored locally. It sources in cross domain source code as Javascript classes and stores those codes in sql db. Later, it can retrieve and run those source code, which effectively renders the page as an interactive app. 
//-----
function PageOff(){
  this.showId = -1;
  this.start= function(){
	this.initDb();
	if (this.loadUrl) this.srcAndSpawn();
	this.getSpawnAppFromDb();
  }
  this.getSpawnAppFromDb= function(){
	var $privThis = this;
	if (this.showId>=0) return this.getFromDb( this.showId, this.spawnApp );
	if (this.addHtmlApp) {
		HtmlApp = new this.HtmlAppFactory( unescape(this.addHtmlApp) ).nuClass;
		this.storeApp( "HtmlApp" );
		this.addHtmlApp= null;
	}
	this.getMaxNum( function(n){
		$privThis.getFromDb( n, $privThis.spawnApp );
	} );
  }
  this.spawnApp= function(s){
	new AppWrapper().deserialize( s ).spawnApp();
  }
  this.srcAndSpawn= function(){
	//add script tag
	//watch for when class becomes available
	//then push to appList and spawn
  }
  this.HtmlAppFactory = function(s){
	var code= "this.constructor= PageOff_HtmlApp;\nthis.constructor();\n";
	this.nuClass = new Function( code + "this.text=" +JSON.stringify(s) );
  }
  this.extendClass = function( cls ){ this.extender=cls; this.extender(); }
  this.extendClass( PageOff_ext_cgi );
  this.extendClass( PageOff_ext_sqldb );
}
//-----
PageOff_ext_sqldb= function(){
  this.initDb = function(){
	this.sd = new DbApp();
	this.sd.sql.getPupById= "SELECT * FROM pups WHERE id=?;"
	this.sd.sql.getMaxId= "SELECT max(id) id FROM pups;"
	this.sd.init( "PageOff" );
  }
  this.getFromDb= function(i, cb){
	this.sd.getPupByIdDb( [i], function(txn, rs){
		if (rs.rows.length>0) cb( rs.rows.item(0)['name'] );
	} );
  }
  this.storeApp= function(name){
	var s = new AppWrapper(name).serialize();
	this.sd.savePupDb( [s], this.resStoreApp );
  }
  this.resStoreApp= function(){
  }
  this.getMaxNum= function( cb ){
	this.sd.getMaxIdDb( [], function(txn, rs){
		if (rs.rows.length>0) cb( rs.rows.item(0)['id'] );
	});
  }
}
//-----
PageOff_ext_cgi = function(){
  this.superStart= this.start;
  this.start= function(){
	this.doCgi();
	this.superStart();
  }
  this.cgi= function(k,def,qy){ var at=(qy+"").split(new RegExp("[\&\?]"+k+"="));
	return (at.length==1)?def:at[1].split("&")[0]; }
  this.doCgi= function(){
	this.showId = this.cgi("id","-1",location);
	this.loadUrl = this.cgi("url", "", location);
	this.clsName = this.cgi("name", "RemCls", location);
	this.addHtmlApp= this.cgi("addhtmlapp","", location);
  }
}

//-----
PageOff_HtmlApp= function(){
  this.text= "This will be displayed.";
  this.start= function(){
	this.write(this.text);
  }
  this.write= function(s){
	document.body.appendChild( document.createElement("div") ).innerHTML=s;
  }
}
//-----
AppWrapper= function(name){
  this.name= name;
  this.serialize= function(){
	var obj = {name:name};
	obj.code= window[name].toString();
	return JSON.stringify(obj);
  }
  this.deserialize= function(s){
	eval( "obj="+ s );
	this.name= obj.name;
	this.code= obj.code;
	return this;
  }
  this.spawnApp= function(){
	eval( "this.ClsTmp="+ this.code );
	new this.ClsTmp().start();
  }
}
new PageOff().start();
</script>
